/// Auto-generated by Deno Win32: Windows.Win32.Security.EnterpriseData.Apis

import * as util from "../../util.ts";

// Enums
export type ENTERPRISE_DATA_POLICIES = number;
export type SRPHOSTING_TYPE = number;
export type SRPHOSTING_VERSION = number;

// Constants
export const ENTERPRISE_POLICY_NONE = 0;
export const ENTERPRISE_POLICY_ALLOWED = 1;
export const ENTERPRISE_POLICY_ENLIGHTENED = 2;
export const ENTERPRISE_POLICY_EXEMPT = 4;
export const SRPHOSTING_TYPE_NONE = 0;
export const SRPHOSTING_TYPE_WINHTTP = 1;
export const SRPHOSTING_TYPE_WININET = 2;
export const SRPHOSTING_VERSION1 = 1;

// Structs

export type HANDLE = Deno.PointerValue;

/**
 * Windows.Win32.Security.EnterpriseData.HTHREAD_NETWORK_CONTEXT (size: 16)
 */
export interface HTHREAD_NETWORK_CONTEXT {
  /** u32 */
  ThreadId: number;
  /** Windows.Win32.Foundation.HANDLE */
  ThreadContext: Uint8Array | Deno.PointerValue | null;
}

export const sizeofHTHREAD_NETWORK_CONTEXT = 16;

export function allocHTHREAD_NETWORK_CONTEXT(data?: Partial<HTHREAD_NETWORK_CONTEXT>): Uint8Array {
  const buf = new Uint8Array(sizeofHTHREAD_NETWORK_CONTEXT);
  const view = new DataView(buf.buffer);
  // 0x00: u32
  if (data?.ThreadId !== undefined) view.setUint32(0, Number(data.ThreadId), true);
  // 0x04: pad4
  // 0x08: pointer
  if (data?.ThreadContext !== undefined) view.setBigUint64(8, data.ThreadContext === null ? 0n : BigInt(util.toPointer(data.ThreadContext)), true);
  return buf;
}

/**
 * Windows.Win32.Security.EnterpriseData.FILE_UNPROTECT_OPTIONS (size: 0)
 */
export interface FILE_UNPROTECT_OPTIONS {
  /** bool */
  audit: boolean;
}

export const sizeofFILE_UNPROTECT_OPTIONS = 0;

export function allocFILE_UNPROTECT_OPTIONS(data?: Partial<FILE_UNPROTECT_OPTIONS>): Uint8Array {
  const buf = new Uint8Array(sizeofFILE_UNPROTECT_OPTIONS);
  const view = new DataView(buf.buffer);
  return buf;
}

export type PWSTR = Deno.PointerValue | Uint8Array | null;

export type HRESULT = number;

export type NTSTATUS = number;

// Native Libraries

try {
  var libsrpapi = Deno.dlopen("srpapi", {
    SrpCreateThreadNetworkContext: {
      parameters: ["buffer", "pointer"],
      result: "pointer",
    },
    SrpCloseThreadNetworkContext: {
      parameters: ["pointer"],
      result: "pointer",
    },
    SrpSetTokenEnterpriseId: {
      parameters: ["pointer", "buffer"],
      result: "pointer",
    },
    SrpGetEnterpriseIds: {
      parameters: ["pointer", "pointer", "pointer", "pointer"],
      result: "pointer",
    },
    SrpEnablePermissiveModeFileEncryption: {
      parameters: ["buffer"],
      result: "pointer",
    },
    SrpDisablePermissiveModeFileEncryption: {
      parameters: [],
      result: "pointer",
    },
    SrpGetEnterprisePolicy: {
      parameters: ["pointer", "pointer"],
      result: "pointer",
    },
    SrpIsTokenService: {
      parameters: ["pointer", "pointer"],
      result: "pointer",
    },
    SrpDoesPolicyAllowAppExecution: {
      parameters: ["pointer", "pointer"],
      result: "pointer",
    },
    SrpHostingInitialize: {
      parameters: ["i32", "i32", "pointer", "u32"],
      result: "pointer",
    },
    SrpHostingTerminate: {
      parameters: ["i32"],
      result: "void",
    },
  }).symbols;
} catch(e) { /* ignore */ }

try {
  var libefswrt = Deno.dlopen("efswrt", {
    ProtectFileToEnterpriseIdentity: {
      parameters: ["buffer", "buffer"],
      result: "pointer",
    },
    UnprotectFile: {
      parameters: ["buffer", "pointer"],
      result: "pointer",
    },
  }).symbols;
} catch(e) { /* ignore */ }

// Symbols

export function SrpCreateThreadNetworkContext(
  enterpriseId: string | null /* Windows.Win32.Foundation.PWSTR */,
  threadNetworkContext: Deno.PointerValue | Uint8Array | null /* ptr */,
): Deno.PointerValue | null /* Windows.Win32.Foundation.HRESULT */ {
  return util.pointerFromFfi(libsrpapi.SrpCreateThreadNetworkContext(util.pwstrToFfi(enterpriseId), util.toPointer(threadNetworkContext)));
}

export function SrpCloseThreadNetworkContext(
  threadNetworkContext: Deno.PointerValue | Uint8Array | null /* ptr */,
): Deno.PointerValue | null /* Windows.Win32.Foundation.HRESULT */ {
  return util.pointerFromFfi(libsrpapi.SrpCloseThreadNetworkContext(util.toPointer(threadNetworkContext)));
}

export function SrpSetTokenEnterpriseId(
  tokenHandle: Uint8Array | Deno.PointerValue | null /* Windows.Win32.Foundation.HANDLE */,
  enterpriseId: string | null /* Windows.Win32.Foundation.PWSTR */,
): Deno.PointerValue | null /* Windows.Win32.Foundation.HRESULT */ {
  return util.pointerFromFfi(libsrpapi.SrpSetTokenEnterpriseId(util.toPointer(tokenHandle), util.pwstrToFfi(enterpriseId)));
}

export function SrpGetEnterpriseIds(
  tokenHandle: Uint8Array | Deno.PointerValue | null /* Windows.Win32.Foundation.HANDLE */,
  numberOfBytes: Deno.PointerValue | Uint8Array | null /* ptr */,
  enterpriseIds: Deno.PointerValue | Uint8Array | null /* ptr */,
  enterpriseIdCount: Deno.PointerValue | Uint8Array | null /* ptr */,
): Deno.PointerValue | null /* Windows.Win32.Foundation.HRESULT */ {
  return util.pointerFromFfi(libsrpapi.SrpGetEnterpriseIds(util.toPointer(tokenHandle), util.toPointer(numberOfBytes), util.toPointer(enterpriseIds), util.toPointer(enterpriseIdCount)));
}

export function SrpEnablePermissiveModeFileEncryption(
  enterpriseId: string | null /* Windows.Win32.Foundation.PWSTR */,
): Deno.PointerValue | null /* Windows.Win32.Foundation.HRESULT */ {
  return util.pointerFromFfi(libsrpapi.SrpEnablePermissiveModeFileEncryption(util.pwstrToFfi(enterpriseId)));
}

export function SrpDisablePermissiveModeFileEncryption(): Deno.PointerValue | null /* Windows.Win32.Foundation.HRESULT */ {
  return util.pointerFromFfi(libsrpapi.SrpDisablePermissiveModeFileEncryption());
}

export function SrpGetEnterprisePolicy(
  tokenHandle: Uint8Array | Deno.PointerValue | null /* Windows.Win32.Foundation.HANDLE */,
  policyFlags: Deno.PointerValue | Uint8Array | null /* ptr */,
): Deno.PointerValue | null /* Windows.Win32.Foundation.HRESULT */ {
  return util.pointerFromFfi(libsrpapi.SrpGetEnterprisePolicy(util.toPointer(tokenHandle), util.toPointer(policyFlags)));
}

export function SrpIsTokenService(
  TokenHandle: Uint8Array | Deno.PointerValue | null /* Windows.Win32.Foundation.HANDLE */,
  IsTokenService: Deno.PointerValue | Uint8Array | null /* ptr */,
): Deno.PointerValue | null /* Windows.Win32.Foundation.NTSTATUS */ {
  return util.pointerFromFfi(libsrpapi.SrpIsTokenService(util.toPointer(TokenHandle), util.toPointer(IsTokenService)));
}

export function SrpDoesPolicyAllowAppExecution(
  packageId: Deno.PointerValue | Uint8Array | null /* ptr */,
  isAllowed: Deno.PointerValue | Uint8Array | null /* ptr */,
): Deno.PointerValue | null /* Windows.Win32.Foundation.HRESULT */ {
  return util.pointerFromFfi(libsrpapi.SrpDoesPolicyAllowAppExecution(util.toPointer(packageId), util.toPointer(isAllowed)));
}

export function SrpHostingInitialize(
  Version: SRPHOSTING_VERSION /* Windows.Win32.Security.EnterpriseData.SRPHOSTING_VERSION */,
  Type: SRPHOSTING_TYPE /* Windows.Win32.Security.EnterpriseData.SRPHOSTING_TYPE */,
  pvData: Deno.PointerValue | Uint8Array | null /* ptr */,
  cbData: number /* u32 */,
): Deno.PointerValue | null /* Windows.Win32.Foundation.HRESULT */ {
  return util.pointerFromFfi(libsrpapi.SrpHostingInitialize(Version, Type, util.toPointer(pvData), cbData));
}

export function SrpHostingTerminate(
  Type: SRPHOSTING_TYPE /* Windows.Win32.Security.EnterpriseData.SRPHOSTING_TYPE */,
): void /* void */ {
  return libsrpapi.SrpHostingTerminate(Type);
}

export function ProtectFileToEnterpriseIdentity(
  fileOrFolderPath: string | null /* Windows.Win32.Foundation.PWSTR */,
  identity: string | null /* Windows.Win32.Foundation.PWSTR */,
): Deno.PointerValue | null /* Windows.Win32.Foundation.HRESULT */ {
  return util.pointerFromFfi(libefswrt.ProtectFileToEnterpriseIdentity(util.pwstrToFfi(fileOrFolderPath), util.pwstrToFfi(identity)));
}

export function UnprotectFile(
  fileOrFolderPath: string | null /* Windows.Win32.Foundation.PWSTR */,
  options: Deno.PointerValue | Uint8Array | null /* ptr */,
): Deno.PointerValue | null /* Windows.Win32.Foundation.HRESULT */ {
  return util.pointerFromFfi(libefswrt.UnprotectFile(util.pwstrToFfi(fileOrFolderPath), util.toPointer(options)));
}

