/// Auto-generated by Deno Win32: Windows.Win32.System.Memory.NonVolatile.Apis

import * as util from "../../../util.ts";

// Structs

/**
 * Windows.Win32.System.Memory.NonVolatile.NV_MEMORY_RANGE (size: 16)
 */
export interface NV_MEMORY_RANGE {
  /** ptr */
  BaseAddress: Deno.PointerValue | Uint8Array;
  /** usize */
  Length: bigint | number;
}

export const sizeofNV_MEMORY_RANGE = 16;

export function allocNV_MEMORY_RANGE(data?: Partial<NV_MEMORY_RANGE>): Uint8Array {
  const buf = new Uint8Array(sizeofNV_MEMORY_RANGE);
  const view = new DataView(buf.buffer);
  // 0x00: pointer
  if (data?.BaseAddress !== undefined) view.setBigUint64(0, data.BaseAddress === null ? 0n : BigInt(Deno.UnsafePointer.value(util.toPointer(data.BaseAddress))), true);
  // 0x08: usize
  if (data?.Length !== undefined) view.setBigUint64(8, BigInt(data.Length), true);
  return buf;
}

export class NV_MEMORY_RANGEView {
  private readonly view: DataView;
  constructor(private readonly buf: Uint8Array) {
    this.view = new DataView(buf.buffer);
  }

  get buffer(): Uint8Array {
    return this.buf;
  }

  // 0x00: pointer
  get BaseAddress(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(0, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x08: usize
  get Length(): bigint | number {
    return Number(this.view.getBigUint64(8, true));
  }

  // 0x00: pointer
  set BaseAddress(value: Uint8Array | Deno.PointerValue) {
    this.view.setBigUint64(0, BigInt(Deno.UnsafePointer.value(util.toPointer(value))), true);
  }

  // 0x08: usize
  set Length(value: bigint | number) {
    this.view.setBigUint64(8, BigInt(value), true);
  }
}

// Native Libraries

try {
  var libntdll_dll = Deno.dlopen("ntdll.dll", {
    RtlGetNonVolatileToken: {
      parameters: ["pointer", "usize", "pointer"],
      result: "u32",
      optional: true,
    },
    RtlFreeNonVolatileToken: {
      parameters: ["pointer"],
      result: "u32",
      optional: true,
    },
    RtlFlushNonVolatileMemory: {
      parameters: ["pointer", "pointer", "usize", "u32"],
      result: "u32",
      optional: true,
    },
    RtlDrainNonVolatileFlush: {
      parameters: ["pointer"],
      result: "u32",
      optional: true,
    },
    RtlWriteNonVolatileMemory: {
      parameters: ["pointer", "pointer", "pointer", "usize", "u32"],
      result: "u32",
      optional: true,
    },
    RtlFillNonVolatileMemory: {
      parameters: ["pointer", "pointer", "usize", "u8", "u32"],
      result: "u32",
      optional: true,
    },
    RtlFlushNonVolatileMemoryRanges: {
      parameters: ["pointer", "pointer", "usize", "u32"],
      result: "u32",
      optional: true,
    },
  }).symbols;
} catch(e) { /* ignore */ }

// Symbols

export function RtlGetNonVolatileToken(
  NvBuffer: Deno.PointerValue | Uint8Array /* ptr */,
  Size: bigint | number /* usize */,
  NvToken: Deno.PointerValue | Uint8Array /* ptr */,
): number /* u32 */ {
  return libntdll_dll.RtlGetNonVolatileToken!(util.toPointer(NvBuffer), Size, util.toPointer(NvToken));
}

export function RtlFreeNonVolatileToken(
  NvToken: Deno.PointerValue | Uint8Array /* ptr */,
): number /* u32 */ {
  return libntdll_dll.RtlFreeNonVolatileToken!(util.toPointer(NvToken));
}

export function RtlFlushNonVolatileMemory(
  NvToken: Deno.PointerValue | Uint8Array /* ptr */,
  NvBuffer: Deno.PointerValue | Uint8Array /* ptr */,
  Size: bigint | number /* usize */,
  Flags: number /* u32 */,
): number /* u32 */ {
  return libntdll_dll.RtlFlushNonVolatileMemory!(util.toPointer(NvToken), util.toPointer(NvBuffer), Size, Flags);
}

export function RtlDrainNonVolatileFlush(
  NvToken: Deno.PointerValue | Uint8Array /* ptr */,
): number /* u32 */ {
  return libntdll_dll.RtlDrainNonVolatileFlush!(util.toPointer(NvToken));
}

export function RtlWriteNonVolatileMemory(
  NvToken: Deno.PointerValue | Uint8Array /* ptr */,
  NvDestination: Deno.PointerValue | Uint8Array /* ptr */,
  Source: Deno.PointerValue | Uint8Array /* ptr */,
  Size: bigint | number /* usize */,
  Flags: number /* u32 */,
): number /* u32 */ {
  return libntdll_dll.RtlWriteNonVolatileMemory!(util.toPointer(NvToken), util.toPointer(NvDestination), util.toPointer(Source), Size, Flags);
}

export function RtlFillNonVolatileMemory(
  NvToken: Deno.PointerValue | Uint8Array /* ptr */,
  NvDestination: Deno.PointerValue | Uint8Array /* ptr */,
  Size: bigint | number /* usize */,
  Value: number /* u8 */,
  Flags: number /* u32 */,
): number /* u32 */ {
  return libntdll_dll.RtlFillNonVolatileMemory!(util.toPointer(NvToken), util.toPointer(NvDestination), Size, Value, Flags);
}

export function RtlFlushNonVolatileMemoryRanges(
  NvToken: Deno.PointerValue | Uint8Array /* ptr */,
  NvRanges: Deno.PointerValue | Uint8Array /* ptr */,
  NumRanges: bigint | number /* usize */,
  Flags: number /* u32 */,
): number /* u32 */ {
  return libntdll_dll.RtlFlushNonVolatileMemoryRanges!(util.toPointer(NvToken), util.toPointer(NvRanges), NumRanges, Flags);
}

