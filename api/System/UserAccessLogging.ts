/// Auto-generated by Deno Win32: Windows.Win32.System.UserAccessLogging.Apis

import * as util from "../../util.ts";

// Structs

/**
 * Windows.Win32.Networking.WinSock.SOCKADDR_STORAGE (size: 32)
 */
export interface SOCKADDR_STORAGE {
  /** u16 */
  ss_family: number;
  /** array */
  __ss_pad1: Deno.PointerValue;
  /** i64 */
  __ss_align: bigint | number;
  /** array */
  __ss_pad2: Deno.PointerValue;
}

export const sizeofSOCKADDR_STORAGE = 32;

export function allocSOCKADDR_STORAGE(data?: Partial<SOCKADDR_STORAGE>): Uint8Array {
  const buf = new Uint8Array(sizeofSOCKADDR_STORAGE);
  const view = new DataView(buf.buffer);
  // 0x00: u16
  if (data?.ss_family !== undefined) view.setUint16(0, Number(data.ss_family), true);
  // 0x02: pad6
  // 0x08: pointer
  if (data?.__ss_pad1 !== undefined) view.setBigUint64(8, data.__ss_pad1 === null ? 0n : BigInt(Deno.UnsafePointer.value(util.toPointer(data.__ss_pad1))), true);
  // 0x10: i64
  if (data?.__ss_align !== undefined) view.setBigInt64(16, BigInt(data.__ss_align), true);
  // 0x18: pointer
  if (data?.__ss_pad2 !== undefined) view.setBigUint64(24, data.__ss_pad2 === null ? 0n : BigInt(Deno.UnsafePointer.value(util.toPointer(data.__ss_pad2))), true);
  return buf;
}

export class SOCKADDR_STORAGEView {
  private readonly view: DataView;
  constructor(private readonly buf: Uint8Array) {
    this.view = new DataView(buf.buffer);
  }

  get buffer(): Uint8Array {
    return this.buf;
  }

  // 0x00: u16
  get ss_family(): number {
    return this.view.getUint16(0, true);
  }

  // 0x02: pad6

  // 0x08: pointer
  get __ss_pad1(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(8, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x10: i64
  get __ss_align(): bigint | number {
    return Number(this.view.getBigInt64(16, true));
  }

  // 0x18: pointer
  get __ss_pad2(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(24, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x00: u16
  set ss_family(value: number) {
    this.view.setUint16(0, value, true);
  }

  // 0x02: pad6

  // 0x08: pointer
  set __ss_pad1(value: Uint8Array | Deno.PointerValue) {
    this.view.setBigUint64(8, BigInt(Deno.UnsafePointer.value(util.toPointer(value))), true);
  }

  // 0x10: i64
  set __ss_align(value: bigint | number) {
    this.view.setBigInt64(16, BigInt(value), true);
  }

  // 0x18: pointer
  set __ss_pad2(value: Uint8Array | Deno.PointerValue) {
    this.view.setBigUint64(24, BigInt(Deno.UnsafePointer.value(util.toPointer(value))), true);
  }
}

/**
 * Windows.Win32.System.UserAccessLogging.UAL_DATA_BLOB (size: 40)
 */
export interface UAL_DATA_BLOB {
  /** u32 */
  Size: number;
  /** System.Guid */
  RoleGuid: Uint8Array | Deno.PointerValue;
  /** System.Guid */
  TenantId: Uint8Array | Deno.PointerValue;
  /** Windows.Win32.Networking.WinSock.SOCKADDR_STORAGE */
  Address: Uint8Array | Deno.PointerValue;
  /** array */
  UserName: Deno.PointerValue;
}

export const sizeofUAL_DATA_BLOB = 40;

export function allocUAL_DATA_BLOB(data?: Partial<UAL_DATA_BLOB>): Uint8Array {
  const buf = new Uint8Array(sizeofUAL_DATA_BLOB);
  const view = new DataView(buf.buffer);
  // 0x00: u32
  if (data?.Size !== undefined) view.setUint32(0, Number(data.Size), true);
  // 0x04: pad4
  // 0x08: pointer
  if (data?.RoleGuid !== undefined) view.setBigUint64(8, data.RoleGuid === null ? 0n : BigInt(Deno.UnsafePointer.value(util.toPointer(data.RoleGuid))), true);
  // 0x10: pointer
  if (data?.TenantId !== undefined) view.setBigUint64(16, data.TenantId === null ? 0n : BigInt(Deno.UnsafePointer.value(util.toPointer(data.TenantId))), true);
  // 0x18: pointer
  if (data?.Address !== undefined) view.setBigUint64(24, data.Address === null ? 0n : BigInt(Deno.UnsafePointer.value(util.toPointer(data.Address))), true);
  // 0x20: pointer
  if (data?.UserName !== undefined) view.setBigUint64(32, data.UserName === null ? 0n : BigInt(Deno.UnsafePointer.value(util.toPointer(data.UserName))), true);
  return buf;
}

export class UAL_DATA_BLOBView {
  private readonly view: DataView;
  constructor(private readonly buf: Uint8Array) {
    this.view = new DataView(buf.buffer);
  }

  get buffer(): Uint8Array {
    return this.buf;
  }

  // 0x00: u32
  get Size(): number {
    return this.view.getUint32(0, true);
  }

  // 0x04: pad4

  // 0x08: pointer
  get RoleGuid(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(8, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x10: pointer
  get TenantId(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(16, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x18: pointer
  get Address(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(24, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x20: pointer
  get UserName(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(32, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x00: u32
  set Size(value: number) {
    this.view.setUint32(0, value, true);
  }

  // 0x04: pad4

  // 0x08: pointer
  set RoleGuid(value: Uint8Array | Deno.PointerValue) {
    this.view.setBigUint64(8, BigInt(Deno.UnsafePointer.value(util.toPointer(value))), true);
  }

  // 0x10: pointer
  set TenantId(value: Uint8Array | Deno.PointerValue) {
    this.view.setBigUint64(16, BigInt(Deno.UnsafePointer.value(util.toPointer(value))), true);
  }

  // 0x18: pointer
  set Address(value: Uint8Array | Deno.PointerValue) {
    this.view.setBigUint64(24, BigInt(Deno.UnsafePointer.value(util.toPointer(value))), true);
  }

  // 0x20: pointer
  set UserName(value: Uint8Array | Deno.PointerValue) {
    this.view.setBigUint64(32, BigInt(Deno.UnsafePointer.value(util.toPointer(value))), true);
  }
}

export type HRESULT = number;

export type PWSTR = Deno.PointerValue | Uint8Array;

// Native Libraries

try {
  var libualapi_dll = Deno.dlopen("ualapi.dll", {
    UalStart: {
      parameters: ["pointer"],
      result: "pointer",
      optional: true,
    },
    UalStop: {
      parameters: ["pointer"],
      result: "pointer",
      optional: true,
    },
    UalInstrument: {
      parameters: ["pointer"],
      result: "pointer",
      optional: true,
    },
    UalRegisterProduct: {
      parameters: ["buffer", "buffer", "buffer"],
      result: "pointer",
      optional: true,
    },
  }).symbols;
} catch(e) { /* ignore */ }

// Symbols

export function UalStart(
  Data: Deno.PointerValue | Uint8Array /* ptr */,
): Deno.PointerValue /* Windows.Win32.Foundation.HRESULT */ {
  return libualapi_dll.UalStart!(util.toPointer(Data));
}

export function UalStop(
  Data: Deno.PointerValue | Uint8Array /* ptr */,
): Deno.PointerValue /* Windows.Win32.Foundation.HRESULT */ {
  return libualapi_dll.UalStop!(util.toPointer(Data));
}

export function UalInstrument(
  Data: Deno.PointerValue | Uint8Array /* ptr */,
): Deno.PointerValue /* Windows.Win32.Foundation.HRESULT */ {
  return libualapi_dll.UalInstrument!(util.toPointer(Data));
}

export function UalRegisterProduct(
  wszProductName: string | null | Uint8Array | Uint16Array /* Windows.Win32.Foundation.PWSTR */,
  wszRoleName: string | null | Uint8Array | Uint16Array /* Windows.Win32.Foundation.PWSTR */,
  wszGuid: string | null | Uint8Array | Uint16Array /* Windows.Win32.Foundation.PWSTR */,
): Deno.PointerValue /* Windows.Win32.Foundation.HRESULT */ {
  return libualapi_dll.UalRegisterProduct!(util.pwstrToFfi(wszProductName), util.pwstrToFfi(wszRoleName), util.pwstrToFfi(wszGuid));
}

