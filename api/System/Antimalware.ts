/// Auto-generated by Deno Win32: Windows.Win32.System.Antimalware.Apis

import * as util from "../../util.ts";

// Enums
export type AMSI_RESULT = number;
export type AMSI_ATTRIBUTE = number;
export type AMSI_UAC_REQUEST_TYPE = number;
export type AMSI_UAC_TRUST_STATE = number;
export type AMSI_UAC_MSI_ACTION = number;

// Constants
export const AMSI_RESULT_CLEAN = 0;
export const AMSI_RESULT_NOT_DETECTED = 1;
export const AMSI_RESULT_BLOCKED_BY_ADMIN_START = 16384;
export const AMSI_RESULT_BLOCKED_BY_ADMIN_END = 20479;
export const AMSI_RESULT_DETECTED = 32768;
export const AMSI_ATTRIBUTE_APP_NAME = 0;
export const AMSI_ATTRIBUTE_CONTENT_NAME = 1;
export const AMSI_ATTRIBUTE_CONTENT_SIZE = 2;
export const AMSI_ATTRIBUTE_CONTENT_ADDRESS = 3;
export const AMSI_ATTRIBUTE_SESSION = 4;
export const AMSI_ATTRIBUTE_REDIRECT_CHAIN_SIZE = 5;
export const AMSI_ATTRIBUTE_REDIRECT_CHAIN_ADDRESS = 6;
export const AMSI_ATTRIBUTE_ALL_SIZE = 7;
export const AMSI_ATTRIBUTE_ALL_ADDRESS = 8;
export const AMSI_ATTRIBUTE_QUIET = 9;
export const AMSI_UAC_REQUEST_TYPE_EXE = 0;
export const AMSI_UAC_REQUEST_TYPE_COM = 1;
export const AMSI_UAC_REQUEST_TYPE_MSI = 2;
export const AMSI_UAC_REQUEST_TYPE_AX = 3;
export const AMSI_UAC_REQUEST_TYPE_PACKAGED_APP = 4;
export const AMSI_UAC_REQUEST_TYPE_MAX = 5;
export const AMSI_UAC_TRUST_STATE_TRUSTED = 0;
export const AMSI_UAC_TRUST_STATE_UNTRUSTED = 1;
export const AMSI_UAC_TRUST_STATE_BLOCKED = 2;
export const AMSI_UAC_TRUST_STATE_MAX = 3;
export const AMSI_UAC_MSI_ACTION_INSTALL = 0;
export const AMSI_UAC_MSI_ACTION_UNINSTALL = 1;
export const AMSI_UAC_MSI_ACTION_UPDATE = 2;
export const AMSI_UAC_MSI_ACTION_MAINTENANCE = 3;
export const AMSI_UAC_MSI_ACTION_MAX = 4;

// Structs

export type PWSTR = Deno.PointerValue | Uint8Array;

/**
 * Windows.Win32.System.Antimalware.AMSI_UAC_REQUEST_EXE_INFO (size: 32)
 */
export interface AMSI_UAC_REQUEST_EXE_INFO {
  /** u32 */
  ulLength: number;
  /** Windows.Win32.Foundation.PWSTR */
  lpwszApplicationName: string | null | Uint8Array | Uint16Array;
  /** Windows.Win32.Foundation.PWSTR */
  lpwszCommandLine: string | null | Uint8Array | Uint16Array;
  /** Windows.Win32.Foundation.PWSTR */
  lpwszDLLParameter: string | null | Uint8Array | Uint16Array;
}

export const sizeofAMSI_UAC_REQUEST_EXE_INFO = 32;

export function allocAMSI_UAC_REQUEST_EXE_INFO(data?: Partial<AMSI_UAC_REQUEST_EXE_INFO>): Uint8Array {
  const buf = new Uint8Array(sizeofAMSI_UAC_REQUEST_EXE_INFO);
  const view = new DataView(buf.buffer);
  // 0x00: u32
  if (data?.ulLength !== undefined) view.setUint32(0, Number(data.ulLength), true);
  // 0x04: pad4
  // 0x08: buffer
  if (data?.lpwszApplicationName !== undefined) {
    (buf as any)._f8 = util.pwstrToFfi(data.lpwszApplicationName);
    view.setBigUint64(8, (buf as any)._f8 === null ? 0n : BigInt(Deno.UnsafePointer.value(Deno.UnsafePointer.of((buf as any)._f8))), true);
  }
  // 0x10: buffer
  if (data?.lpwszCommandLine !== undefined) {
    (buf as any)._f16 = util.pwstrToFfi(data.lpwszCommandLine);
    view.setBigUint64(16, (buf as any)._f16 === null ? 0n : BigInt(Deno.UnsafePointer.value(Deno.UnsafePointer.of((buf as any)._f16))), true);
  }
  // 0x18: buffer
  if (data?.lpwszDLLParameter !== undefined) {
    (buf as any)._f24 = util.pwstrToFfi(data.lpwszDLLParameter);
    view.setBigUint64(24, (buf as any)._f24 === null ? 0n : BigInt(Deno.UnsafePointer.value(Deno.UnsafePointer.of((buf as any)._f24))), true);
  }
  return buf;
}

export class AMSI_UAC_REQUEST_EXE_INFOView {
  private readonly view: DataView;
  constructor(private readonly buf: Uint8Array) {
    this.view = new DataView(buf.buffer);
  }

  get buffer(): Uint8Array {
    return this.buf;
  }

  // 0x00: u32
  get ulLength(): number {
    return this.view.getUint32(0, true);
  }

  // 0x04: pad4

  // 0x08: buffer
  get lpwszApplicationName(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(8, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x10: buffer
  get lpwszCommandLine(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(16, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x18: buffer
  get lpwszDLLParameter(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(24, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x00: u32
  set ulLength(value: number) {
    this.view.setUint32(0, value, true);
  }

  // 0x04: pad4

  // 0x08: buffer
  set lpwszApplicationName(value: Uint8Array | Deno.PointerValue) {
    (this.buf as any)._f8 = value;
    this.view.setBigUint64(8, BigInt(Deno.UnsafePointer.value(util.toPointer((this.buf as any)._f8))), true);
  }

  // 0x10: buffer
  set lpwszCommandLine(value: Uint8Array | Deno.PointerValue) {
    (this.buf as any)._f16 = value;
    this.view.setBigUint64(16, BigInt(Deno.UnsafePointer.value(util.toPointer((this.buf as any)._f16))), true);
  }

  // 0x18: buffer
  set lpwszDLLParameter(value: Uint8Array | Deno.PointerValue) {
    (this.buf as any)._f24 = value;
    this.view.setBigUint64(24, BigInt(Deno.UnsafePointer.value(util.toPointer((this.buf as any)._f24))), true);
  }
}

/**
 * Windows.Win32.System.Antimalware.AMSI_UAC_REQUEST_COM_INFO (size: 32)
 */
export interface AMSI_UAC_REQUEST_COM_INFO {
  /** u32 */
  ulLength: number;
  /** Windows.Win32.Foundation.PWSTR */
  lpwszServerBinary: string | null | Uint8Array | Uint16Array;
  /** Windows.Win32.Foundation.PWSTR */
  lpwszRequestor: string | null | Uint8Array | Uint16Array;
  /** System.Guid */
  Clsid: Uint8Array | Deno.PointerValue;
}

export const sizeofAMSI_UAC_REQUEST_COM_INFO = 32;

export function allocAMSI_UAC_REQUEST_COM_INFO(data?: Partial<AMSI_UAC_REQUEST_COM_INFO>): Uint8Array {
  const buf = new Uint8Array(sizeofAMSI_UAC_REQUEST_COM_INFO);
  const view = new DataView(buf.buffer);
  // 0x00: u32
  if (data?.ulLength !== undefined) view.setUint32(0, Number(data.ulLength), true);
  // 0x04: pad4
  // 0x08: buffer
  if (data?.lpwszServerBinary !== undefined) {
    (buf as any)._f8 = util.pwstrToFfi(data.lpwszServerBinary);
    view.setBigUint64(8, (buf as any)._f8 === null ? 0n : BigInt(Deno.UnsafePointer.value(Deno.UnsafePointer.of((buf as any)._f8))), true);
  }
  // 0x10: buffer
  if (data?.lpwszRequestor !== undefined) {
    (buf as any)._f16 = util.pwstrToFfi(data.lpwszRequestor);
    view.setBigUint64(16, (buf as any)._f16 === null ? 0n : BigInt(Deno.UnsafePointer.value(Deno.UnsafePointer.of((buf as any)._f16))), true);
  }
  // 0x18: pointer
  if (data?.Clsid !== undefined) view.setBigUint64(24, data.Clsid === null ? 0n : BigInt(Deno.UnsafePointer.value(util.toPointer(data.Clsid))), true);
  return buf;
}

export class AMSI_UAC_REQUEST_COM_INFOView {
  private readonly view: DataView;
  constructor(private readonly buf: Uint8Array) {
    this.view = new DataView(buf.buffer);
  }

  get buffer(): Uint8Array {
    return this.buf;
  }

  // 0x00: u32
  get ulLength(): number {
    return this.view.getUint32(0, true);
  }

  // 0x04: pad4

  // 0x08: buffer
  get lpwszServerBinary(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(8, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x10: buffer
  get lpwszRequestor(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(16, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x18: pointer
  get Clsid(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(24, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x00: u32
  set ulLength(value: number) {
    this.view.setUint32(0, value, true);
  }

  // 0x04: pad4

  // 0x08: buffer
  set lpwszServerBinary(value: Uint8Array | Deno.PointerValue) {
    (this.buf as any)._f8 = value;
    this.view.setBigUint64(8, BigInt(Deno.UnsafePointer.value(util.toPointer((this.buf as any)._f8))), true);
  }

  // 0x10: buffer
  set lpwszRequestor(value: Uint8Array | Deno.PointerValue) {
    (this.buf as any)._f16 = value;
    this.view.setBigUint64(16, BigInt(Deno.UnsafePointer.value(util.toPointer((this.buf as any)._f16))), true);
  }

  // 0x18: pointer
  set Clsid(value: Uint8Array | Deno.PointerValue) {
    this.view.setBigUint64(24, BigInt(Deno.UnsafePointer.value(util.toPointer(value))), true);
  }
}

/**
 * Windows.Win32.System.Antimalware.AMSI_UAC_REQUEST_MSI_INFO (size: 80)
 */
export interface AMSI_UAC_REQUEST_MSI_INFO {
  /** u32 */
  ulLength: number;
  /** Windows.Win32.System.Antimalware.AMSI_UAC_MSI_ACTION */
  MsiAction: AMSI_UAC_MSI_ACTION;
  /** Windows.Win32.Foundation.PWSTR */
  lpwszProductName: string | null | Uint8Array | Uint16Array;
  /** Windows.Win32.Foundation.PWSTR */
  lpwszVersion: string | null | Uint8Array | Uint16Array;
  /** Windows.Win32.Foundation.PWSTR */
  lpwszLanguage: string | null | Uint8Array | Uint16Array;
  /** Windows.Win32.Foundation.PWSTR */
  lpwszManufacturer: string | null | Uint8Array | Uint16Array;
  /** Windows.Win32.Foundation.PWSTR */
  lpwszPackagePath: string | null | Uint8Array | Uint16Array;
  /** Windows.Win32.Foundation.PWSTR */
  lpwszPackageSource: string | null | Uint8Array | Uint16Array;
  /** u32 */
  ulUpdates: number;
  /** ptr */
  ppwszUpdates: Deno.PointerValue | Uint8Array;
  /** ptr */
  ppwszUpdateSources: Deno.PointerValue | Uint8Array;
}

export const sizeofAMSI_UAC_REQUEST_MSI_INFO = 80;

export function allocAMSI_UAC_REQUEST_MSI_INFO(data?: Partial<AMSI_UAC_REQUEST_MSI_INFO>): Uint8Array {
  const buf = new Uint8Array(sizeofAMSI_UAC_REQUEST_MSI_INFO);
  const view = new DataView(buf.buffer);
  // 0x00: u32
  if (data?.ulLength !== undefined) view.setUint32(0, Number(data.ulLength), true);
  // 0x04: i32
  if (data?.MsiAction !== undefined) view.setInt32(4, Number(data.MsiAction), true);
  // 0x08: buffer
  if (data?.lpwszProductName !== undefined) {
    (buf as any)._f8 = util.pwstrToFfi(data.lpwszProductName);
    view.setBigUint64(8, (buf as any)._f8 === null ? 0n : BigInt(Deno.UnsafePointer.value(Deno.UnsafePointer.of((buf as any)._f8))), true);
  }
  // 0x10: buffer
  if (data?.lpwszVersion !== undefined) {
    (buf as any)._f16 = util.pwstrToFfi(data.lpwszVersion);
    view.setBigUint64(16, (buf as any)._f16 === null ? 0n : BigInt(Deno.UnsafePointer.value(Deno.UnsafePointer.of((buf as any)._f16))), true);
  }
  // 0x18: buffer
  if (data?.lpwszLanguage !== undefined) {
    (buf as any)._f24 = util.pwstrToFfi(data.lpwszLanguage);
    view.setBigUint64(24, (buf as any)._f24 === null ? 0n : BigInt(Deno.UnsafePointer.value(Deno.UnsafePointer.of((buf as any)._f24))), true);
  }
  // 0x20: buffer
  if (data?.lpwszManufacturer !== undefined) {
    (buf as any)._f32 = util.pwstrToFfi(data.lpwszManufacturer);
    view.setBigUint64(32, (buf as any)._f32 === null ? 0n : BigInt(Deno.UnsafePointer.value(Deno.UnsafePointer.of((buf as any)._f32))), true);
  }
  // 0x28: buffer
  if (data?.lpwszPackagePath !== undefined) {
    (buf as any)._f40 = util.pwstrToFfi(data.lpwszPackagePath);
    view.setBigUint64(40, (buf as any)._f40 === null ? 0n : BigInt(Deno.UnsafePointer.value(Deno.UnsafePointer.of((buf as any)._f40))), true);
  }
  // 0x30: buffer
  if (data?.lpwszPackageSource !== undefined) {
    (buf as any)._f48 = util.pwstrToFfi(data.lpwszPackageSource);
    view.setBigUint64(48, (buf as any)._f48 === null ? 0n : BigInt(Deno.UnsafePointer.value(Deno.UnsafePointer.of((buf as any)._f48))), true);
  }
  // 0x38: u32
  if (data?.ulUpdates !== undefined) view.setUint32(56, Number(data.ulUpdates), true);
  // 0x3c: pad4
  // 0x40: pointer
  if (data?.ppwszUpdates !== undefined) view.setBigUint64(64, data.ppwszUpdates === null ? 0n : BigInt(Deno.UnsafePointer.value(util.toPointer(data.ppwszUpdates))), true);
  // 0x48: pointer
  if (data?.ppwszUpdateSources !== undefined) view.setBigUint64(72, data.ppwszUpdateSources === null ? 0n : BigInt(Deno.UnsafePointer.value(util.toPointer(data.ppwszUpdateSources))), true);
  return buf;
}

export class AMSI_UAC_REQUEST_MSI_INFOView {
  private readonly view: DataView;
  constructor(private readonly buf: Uint8Array) {
    this.view = new DataView(buf.buffer);
  }

  get buffer(): Uint8Array {
    return this.buf;
  }

  // 0x00: u32
  get ulLength(): number {
    return this.view.getUint32(0, true);
  }

  // 0x04: i32
  get MsiAction(): number {
    return this.view.getInt32(4, true);
  }

  // 0x08: buffer
  get lpwszProductName(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(8, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x10: buffer
  get lpwszVersion(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(16, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x18: buffer
  get lpwszLanguage(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(24, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x20: buffer
  get lpwszManufacturer(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(32, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x28: buffer
  get lpwszPackagePath(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(40, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x30: buffer
  get lpwszPackageSource(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(48, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x38: u32
  get ulUpdates(): number {
    return this.view.getUint32(56, true);
  }

  // 0x3c: pad4

  // 0x40: pointer
  get ppwszUpdates(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(64, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x48: pointer
  get ppwszUpdateSources(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(72, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x00: u32
  set ulLength(value: number) {
    this.view.setUint32(0, value, true);
  }

  // 0x04: i32
  set MsiAction(value: number) {
    this.view.setInt32(4, value, true);
  }

  // 0x08: buffer
  set lpwszProductName(value: Uint8Array | Deno.PointerValue) {
    (this.buf as any)._f8 = value;
    this.view.setBigUint64(8, BigInt(Deno.UnsafePointer.value(util.toPointer((this.buf as any)._f8))), true);
  }

  // 0x10: buffer
  set lpwszVersion(value: Uint8Array | Deno.PointerValue) {
    (this.buf as any)._f16 = value;
    this.view.setBigUint64(16, BigInt(Deno.UnsafePointer.value(util.toPointer((this.buf as any)._f16))), true);
  }

  // 0x18: buffer
  set lpwszLanguage(value: Uint8Array | Deno.PointerValue) {
    (this.buf as any)._f24 = value;
    this.view.setBigUint64(24, BigInt(Deno.UnsafePointer.value(util.toPointer((this.buf as any)._f24))), true);
  }

  // 0x20: buffer
  set lpwszManufacturer(value: Uint8Array | Deno.PointerValue) {
    (this.buf as any)._f32 = value;
    this.view.setBigUint64(32, BigInt(Deno.UnsafePointer.value(util.toPointer((this.buf as any)._f32))), true);
  }

  // 0x28: buffer
  set lpwszPackagePath(value: Uint8Array | Deno.PointerValue) {
    (this.buf as any)._f40 = value;
    this.view.setBigUint64(40, BigInt(Deno.UnsafePointer.value(util.toPointer((this.buf as any)._f40))), true);
  }

  // 0x30: buffer
  set lpwszPackageSource(value: Uint8Array | Deno.PointerValue) {
    (this.buf as any)._f48 = value;
    this.view.setBigUint64(48, BigInt(Deno.UnsafePointer.value(util.toPointer((this.buf as any)._f48))), true);
  }

  // 0x38: u32
  set ulUpdates(value: number) {
    this.view.setUint32(56, value, true);
  }

  // 0x3c: pad4

  // 0x40: pointer
  set ppwszUpdates(value: Uint8Array | Deno.PointerValue) {
    this.view.setBigUint64(64, BigInt(Deno.UnsafePointer.value(util.toPointer(value))), true);
  }

  // 0x48: pointer
  set ppwszUpdateSources(value: Uint8Array | Deno.PointerValue) {
    this.view.setBigUint64(72, BigInt(Deno.UnsafePointer.value(util.toPointer(value))), true);
  }
}

/**
 * Windows.Win32.System.Antimalware.AMSI_UAC_REQUEST_AX_INFO (size: 24)
 */
export interface AMSI_UAC_REQUEST_AX_INFO {
  /** u32 */
  ulLength: number;
  /** Windows.Win32.Foundation.PWSTR */
  lpwszLocalInstallPath: string | null | Uint8Array | Uint16Array;
  /** Windows.Win32.Foundation.PWSTR */
  lpwszSourceURL: string | null | Uint8Array | Uint16Array;
}

export const sizeofAMSI_UAC_REQUEST_AX_INFO = 24;

export function allocAMSI_UAC_REQUEST_AX_INFO(data?: Partial<AMSI_UAC_REQUEST_AX_INFO>): Uint8Array {
  const buf = new Uint8Array(sizeofAMSI_UAC_REQUEST_AX_INFO);
  const view = new DataView(buf.buffer);
  // 0x00: u32
  if (data?.ulLength !== undefined) view.setUint32(0, Number(data.ulLength), true);
  // 0x04: pad4
  // 0x08: buffer
  if (data?.lpwszLocalInstallPath !== undefined) {
    (buf as any)._f8 = util.pwstrToFfi(data.lpwszLocalInstallPath);
    view.setBigUint64(8, (buf as any)._f8 === null ? 0n : BigInt(Deno.UnsafePointer.value(Deno.UnsafePointer.of((buf as any)._f8))), true);
  }
  // 0x10: buffer
  if (data?.lpwszSourceURL !== undefined) {
    (buf as any)._f16 = util.pwstrToFfi(data.lpwszSourceURL);
    view.setBigUint64(16, (buf as any)._f16 === null ? 0n : BigInt(Deno.UnsafePointer.value(Deno.UnsafePointer.of((buf as any)._f16))), true);
  }
  return buf;
}

export class AMSI_UAC_REQUEST_AX_INFOView {
  private readonly view: DataView;
  constructor(private readonly buf: Uint8Array) {
    this.view = new DataView(buf.buffer);
  }

  get buffer(): Uint8Array {
    return this.buf;
  }

  // 0x00: u32
  get ulLength(): number {
    return this.view.getUint32(0, true);
  }

  // 0x04: pad4

  // 0x08: buffer
  get lpwszLocalInstallPath(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(8, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x10: buffer
  get lpwszSourceURL(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(16, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x00: u32
  set ulLength(value: number) {
    this.view.setUint32(0, value, true);
  }

  // 0x04: pad4

  // 0x08: buffer
  set lpwszLocalInstallPath(value: Uint8Array | Deno.PointerValue) {
    (this.buf as any)._f8 = value;
    this.view.setBigUint64(8, BigInt(Deno.UnsafePointer.value(util.toPointer((this.buf as any)._f8))), true);
  }

  // 0x10: buffer
  set lpwszSourceURL(value: Uint8Array | Deno.PointerValue) {
    (this.buf as any)._f16 = value;
    this.view.setBigUint64(16, BigInt(Deno.UnsafePointer.value(util.toPointer((this.buf as any)._f16))), true);
  }
}

/**
 * Windows.Win32.System.Antimalware.AMSI_UAC_REQUEST_PACKAGED_APP_INFO (size: 40)
 */
export interface AMSI_UAC_REQUEST_PACKAGED_APP_INFO {
  /** u32 */
  ulLength: number;
  /** Windows.Win32.Foundation.PWSTR */
  lpwszApplicationName: string | null | Uint8Array | Uint16Array;
  /** Windows.Win32.Foundation.PWSTR */
  lpwszCommandLine: string | null | Uint8Array | Uint16Array;
  /** Windows.Win32.Foundation.PWSTR */
  lpPackageFamilyName: string | null | Uint8Array | Uint16Array;
  /** Windows.Win32.Foundation.PWSTR */
  lpApplicationId: string | null | Uint8Array | Uint16Array;
}

export const sizeofAMSI_UAC_REQUEST_PACKAGED_APP_INFO = 40;

export function allocAMSI_UAC_REQUEST_PACKAGED_APP_INFO(data?: Partial<AMSI_UAC_REQUEST_PACKAGED_APP_INFO>): Uint8Array {
  const buf = new Uint8Array(sizeofAMSI_UAC_REQUEST_PACKAGED_APP_INFO);
  const view = new DataView(buf.buffer);
  // 0x00: u32
  if (data?.ulLength !== undefined) view.setUint32(0, Number(data.ulLength), true);
  // 0x04: pad4
  // 0x08: buffer
  if (data?.lpwszApplicationName !== undefined) {
    (buf as any)._f8 = util.pwstrToFfi(data.lpwszApplicationName);
    view.setBigUint64(8, (buf as any)._f8 === null ? 0n : BigInt(Deno.UnsafePointer.value(Deno.UnsafePointer.of((buf as any)._f8))), true);
  }
  // 0x10: buffer
  if (data?.lpwszCommandLine !== undefined) {
    (buf as any)._f16 = util.pwstrToFfi(data.lpwszCommandLine);
    view.setBigUint64(16, (buf as any)._f16 === null ? 0n : BigInt(Deno.UnsafePointer.value(Deno.UnsafePointer.of((buf as any)._f16))), true);
  }
  // 0x18: buffer
  if (data?.lpPackageFamilyName !== undefined) {
    (buf as any)._f24 = util.pwstrToFfi(data.lpPackageFamilyName);
    view.setBigUint64(24, (buf as any)._f24 === null ? 0n : BigInt(Deno.UnsafePointer.value(Deno.UnsafePointer.of((buf as any)._f24))), true);
  }
  // 0x20: buffer
  if (data?.lpApplicationId !== undefined) {
    (buf as any)._f32 = util.pwstrToFfi(data.lpApplicationId);
    view.setBigUint64(32, (buf as any)._f32 === null ? 0n : BigInt(Deno.UnsafePointer.value(Deno.UnsafePointer.of((buf as any)._f32))), true);
  }
  return buf;
}

export class AMSI_UAC_REQUEST_PACKAGED_APP_INFOView {
  private readonly view: DataView;
  constructor(private readonly buf: Uint8Array) {
    this.view = new DataView(buf.buffer);
  }

  get buffer(): Uint8Array {
    return this.buf;
  }

  // 0x00: u32
  get ulLength(): number {
    return this.view.getUint32(0, true);
  }

  // 0x04: pad4

  // 0x08: buffer
  get lpwszApplicationName(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(8, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x10: buffer
  get lpwszCommandLine(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(16, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x18: buffer
  get lpPackageFamilyName(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(24, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x20: buffer
  get lpApplicationId(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(32, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x00: u32
  set ulLength(value: number) {
    this.view.setUint32(0, value, true);
  }

  // 0x04: pad4

  // 0x08: buffer
  set lpwszApplicationName(value: Uint8Array | Deno.PointerValue) {
    (this.buf as any)._f8 = value;
    this.view.setBigUint64(8, BigInt(Deno.UnsafePointer.value(util.toPointer((this.buf as any)._f8))), true);
  }

  // 0x10: buffer
  set lpwszCommandLine(value: Uint8Array | Deno.PointerValue) {
    (this.buf as any)._f16 = value;
    this.view.setBigUint64(16, BigInt(Deno.UnsafePointer.value(util.toPointer((this.buf as any)._f16))), true);
  }

  // 0x18: buffer
  set lpPackageFamilyName(value: Uint8Array | Deno.PointerValue) {
    (this.buf as any)._f24 = value;
    this.view.setBigUint64(24, BigInt(Deno.UnsafePointer.value(util.toPointer((this.buf as any)._f24))), true);
  }

  // 0x20: buffer
  set lpApplicationId(value: Uint8Array | Deno.PointerValue) {
    (this.buf as any)._f32 = value;
    this.view.setBigUint64(32, BigInt(Deno.UnsafePointer.value(util.toPointer((this.buf as any)._f32))), true);
  }
}

/**
 * _RequestType_e__Union (size: 40)
 */
export interface _RequestType_e__Union {
  /** Windows.Win32.System.Antimalware.AMSI_UAC_REQUEST_EXE_INFO */
  ExeInfo: Uint8Array | Deno.PointerValue;
  /** Windows.Win32.System.Antimalware.AMSI_UAC_REQUEST_COM_INFO */
  ComInfo: Uint8Array | Deno.PointerValue;
  /** Windows.Win32.System.Antimalware.AMSI_UAC_REQUEST_MSI_INFO */
  MsiInfo: Uint8Array | Deno.PointerValue;
  /** Windows.Win32.System.Antimalware.AMSI_UAC_REQUEST_AX_INFO */
  ActiveXInfo: Uint8Array | Deno.PointerValue;
  /** Windows.Win32.System.Antimalware.AMSI_UAC_REQUEST_PACKAGED_APP_INFO */
  PackagedAppInfo: Uint8Array | Deno.PointerValue;
}

export const sizeof_RequestType_e__Union = 40;

export function alloc_RequestType_e__Union(data?: Partial<_RequestType_e__Union>): Uint8Array {
  const buf = new Uint8Array(sizeof_RequestType_e__Union);
  const view = new DataView(buf.buffer);
  // 0x00: pointer
  if (data?.ExeInfo !== undefined) view.setBigUint64(0, data.ExeInfo === null ? 0n : BigInt(Deno.UnsafePointer.value(util.toPointer(data.ExeInfo))), true);
  // 0x08: pointer
  if (data?.ComInfo !== undefined) view.setBigUint64(8, data.ComInfo === null ? 0n : BigInt(Deno.UnsafePointer.value(util.toPointer(data.ComInfo))), true);
  // 0x10: pointer
  if (data?.MsiInfo !== undefined) view.setBigUint64(16, data.MsiInfo === null ? 0n : BigInt(Deno.UnsafePointer.value(util.toPointer(data.MsiInfo))), true);
  // 0x18: pointer
  if (data?.ActiveXInfo !== undefined) view.setBigUint64(24, data.ActiveXInfo === null ? 0n : BigInt(Deno.UnsafePointer.value(util.toPointer(data.ActiveXInfo))), true);
  // 0x20: pointer
  if (data?.PackagedAppInfo !== undefined) view.setBigUint64(32, data.PackagedAppInfo === null ? 0n : BigInt(Deno.UnsafePointer.value(util.toPointer(data.PackagedAppInfo))), true);
  return buf;
}

export class _RequestType_e__UnionView {
  private readonly view: DataView;
  constructor(private readonly buf: Uint8Array) {
    this.view = new DataView(buf.buffer);
  }

  get buffer(): Uint8Array {
    return this.buf;
  }

  // 0x00: pointer
  get ExeInfo(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(0, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x08: pointer
  get ComInfo(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(8, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x10: pointer
  get MsiInfo(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(16, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x18: pointer
  get ActiveXInfo(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(24, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x20: pointer
  get PackagedAppInfo(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(32, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x00: pointer
  set ExeInfo(value: Uint8Array | Deno.PointerValue) {
    this.view.setBigUint64(0, BigInt(Deno.UnsafePointer.value(util.toPointer(value))), true);
  }

  // 0x08: pointer
  set ComInfo(value: Uint8Array | Deno.PointerValue) {
    this.view.setBigUint64(8, BigInt(Deno.UnsafePointer.value(util.toPointer(value))), true);
  }

  // 0x10: pointer
  set MsiInfo(value: Uint8Array | Deno.PointerValue) {
    this.view.setBigUint64(16, BigInt(Deno.UnsafePointer.value(util.toPointer(value))), true);
  }

  // 0x18: pointer
  set ActiveXInfo(value: Uint8Array | Deno.PointerValue) {
    this.view.setBigUint64(24, BigInt(Deno.UnsafePointer.value(util.toPointer(value))), true);
  }

  // 0x20: pointer
  set PackagedAppInfo(value: Uint8Array | Deno.PointerValue) {
    this.view.setBigUint64(32, BigInt(Deno.UnsafePointer.value(util.toPointer(value))), true);
  }
}

export type BOOL = number;

/**
 * Windows.Win32.System.Antimalware.AMSI_UAC_REQUEST_CONTEXT (size: 32)
 */
export interface AMSI_UAC_REQUEST_CONTEXT {
  /** u32 */
  ulLength: number;
  /** u32 */
  ulRequestorProcessId: number;
  /** Windows.Win32.System.Antimalware.AMSI_UAC_TRUST_STATE */
  UACTrustState: AMSI_UAC_TRUST_STATE;
  /** Windows.Win32.System.Antimalware.AMSI_UAC_REQUEST_TYPE */
  Type: AMSI_UAC_REQUEST_TYPE;
  /** _RequestType_e__Union */
  RequestType: Uint8Array | Deno.PointerValue;
  /** Windows.Win32.Foundation.BOOL */
  bAutoElevateRequest: boolean;
}

export const sizeofAMSI_UAC_REQUEST_CONTEXT = 32;

export function allocAMSI_UAC_REQUEST_CONTEXT(data?: Partial<AMSI_UAC_REQUEST_CONTEXT>): Uint8Array {
  const buf = new Uint8Array(sizeofAMSI_UAC_REQUEST_CONTEXT);
  const view = new DataView(buf.buffer);
  // 0x00: u32
  if (data?.ulLength !== undefined) view.setUint32(0, Number(data.ulLength), true);
  // 0x04: u32
  if (data?.ulRequestorProcessId !== undefined) view.setUint32(4, Number(data.ulRequestorProcessId), true);
  // 0x08: i32
  if (data?.UACTrustState !== undefined) view.setInt32(8, Number(data.UACTrustState), true);
  // 0x0c: i32
  if (data?.Type !== undefined) view.setInt32(12, Number(data.Type), true);
  // 0x10: pointer
  if (data?.RequestType !== undefined) view.setBigUint64(16, data.RequestType === null ? 0n : BigInt(Deno.UnsafePointer.value(util.toPointer(data.RequestType))), true);
  // 0x18: i32
  if (data?.bAutoElevateRequest !== undefined) view.setInt32(24, Number(data.bAutoElevateRequest), true);
  // 0x1c: pad4
  return buf;
}

export class AMSI_UAC_REQUEST_CONTEXTView {
  private readonly view: DataView;
  constructor(private readonly buf: Uint8Array) {
    this.view = new DataView(buf.buffer);
  }

  get buffer(): Uint8Array {
    return this.buf;
  }

  // 0x00: u32
  get ulLength(): number {
    return this.view.getUint32(0, true);
  }

  // 0x04: u32
  get ulRequestorProcessId(): number {
    return this.view.getUint32(4, true);
  }

  // 0x08: i32
  get UACTrustState(): number {
    return this.view.getInt32(8, true);
  }

  // 0x0c: i32
  get Type(): number {
    return this.view.getInt32(12, true);
  }

  // 0x10: pointer
  get RequestType(): Uint8Array | Deno.PointerValue {
    const ptr = this.view.getBigUint64(16, true);
    return Deno.UnsafePointer.create(ptr);
  }

  // 0x18: i32
  get bAutoElevateRequest(): number {
    return this.view.getInt32(24, true);
  }

  // 0x1c: pad4

  // 0x00: u32
  set ulLength(value: number) {
    this.view.setUint32(0, value, true);
  }

  // 0x04: u32
  set ulRequestorProcessId(value: number) {
    this.view.setUint32(4, value, true);
  }

  // 0x08: i32
  set UACTrustState(value: number) {
    this.view.setInt32(8, value, true);
  }

  // 0x0c: i32
  set Type(value: number) {
    this.view.setInt32(12, value, true);
  }

  // 0x10: pointer
  set RequestType(value: Uint8Array | Deno.PointerValue) {
    this.view.setBigUint64(16, BigInt(Deno.UnsafePointer.value(util.toPointer(value))), true);
  }

  // 0x18: i32
  set bAutoElevateRequest(value: number) {
    this.view.setInt32(24, value, true);
  }

  // 0x1c: pad4
}

export type HAMSICONTEXT = bigint | number;

export type HAMSISESSION = bigint | number;

export type HRESULT = number;

export type HANDLE = bigint | number;

// Native Libraries

try {
  var libAmsi_dll = Deno.dlopen("Amsi.dll", {
    AmsiInitialize: {
      parameters: ["buffer", "pointer"],
      result: "pointer",
      optional: true,
    },
    AmsiUninitialize: {
      parameters: ["pointer"],
      result: "void",
      optional: true,
    },
    AmsiOpenSession: {
      parameters: ["pointer", "pointer"],
      result: "pointer",
      optional: true,
    },
    AmsiCloseSession: {
      parameters: ["pointer", "pointer"],
      result: "void",
      optional: true,
    },
    AmsiScanBuffer: {
      parameters: ["pointer", "pointer", "u32", "buffer", "pointer", "pointer"],
      result: "pointer",
      optional: true,
    },
    AmsiNotifyOperation: {
      parameters: ["pointer", "pointer", "u32", "buffer", "pointer"],
      result: "pointer",
      optional: true,
    },
    AmsiScanString: {
      parameters: ["pointer", "buffer", "buffer", "pointer", "pointer"],
      result: "pointer",
      optional: true,
    },
  }).symbols;
} catch(e) { /* ignore */ }

try {
  var libKERNEL32_dll = Deno.dlopen("KERNEL32.dll", {
    InstallELAMCertificateInfo: {
      parameters: ["pointer"],
      result: "i32",
      optional: true,
    },
  }).symbols;
} catch(e) { /* ignore */ }

// Symbols

export function AmsiInitialize(
  appName: string | null | Uint8Array | Uint16Array /* Windows.Win32.Foundation.PWSTR */,
  amsiContext: Deno.PointerValue | Uint8Array /* ptr */,
): Deno.PointerValue /* Windows.Win32.Foundation.HRESULT */ {
  return libAmsi_dll.AmsiInitialize!(util.pwstrToFfi(appName), util.toPointer(amsiContext));
}

export function AmsiUninitialize(
  amsiContext: Uint8Array | Deno.PointerValue /* Windows.Win32.System.Antimalware.HAMSICONTEXT */,
): void /* void */ {
  return libAmsi_dll.AmsiUninitialize!(util.toPointer(amsiContext));
}

export function AmsiOpenSession(
  amsiContext: Uint8Array | Deno.PointerValue /* Windows.Win32.System.Antimalware.HAMSICONTEXT */,
  amsiSession: Deno.PointerValue | Uint8Array /* ptr */,
): Deno.PointerValue /* Windows.Win32.Foundation.HRESULT */ {
  return libAmsi_dll.AmsiOpenSession!(util.toPointer(amsiContext), util.toPointer(amsiSession));
}

export function AmsiCloseSession(
  amsiContext: Uint8Array | Deno.PointerValue /* Windows.Win32.System.Antimalware.HAMSICONTEXT */,
  amsiSession: Uint8Array | Deno.PointerValue /* Windows.Win32.System.Antimalware.HAMSISESSION */,
): void /* void */ {
  return libAmsi_dll.AmsiCloseSession!(util.toPointer(amsiContext), util.toPointer(amsiSession));
}

export function AmsiScanBuffer(
  amsiContext: Uint8Array | Deno.PointerValue /* Windows.Win32.System.Antimalware.HAMSICONTEXT */,
  buffer: Deno.PointerValue | Uint8Array /* ptr */,
  length: number /* u32 */,
  contentName: string | null | Uint8Array | Uint16Array /* Windows.Win32.Foundation.PWSTR */,
  amsiSession: Uint8Array | Deno.PointerValue /* Windows.Win32.System.Antimalware.HAMSISESSION */,
  result: Deno.PointerValue | Uint8Array /* ptr */,
): Deno.PointerValue /* Windows.Win32.Foundation.HRESULT */ {
  return libAmsi_dll.AmsiScanBuffer!(util.toPointer(amsiContext), util.toPointer(buffer), length, util.pwstrToFfi(contentName), util.toPointer(amsiSession), util.toPointer(result));
}

export function AmsiNotifyOperation(
  amsiContext: Uint8Array | Deno.PointerValue /* Windows.Win32.System.Antimalware.HAMSICONTEXT */,
  buffer: Deno.PointerValue | Uint8Array /* ptr */,
  length: number /* u32 */,
  contentName: string | null | Uint8Array | Uint16Array /* Windows.Win32.Foundation.PWSTR */,
  result: Deno.PointerValue | Uint8Array /* ptr */,
): Deno.PointerValue /* Windows.Win32.Foundation.HRESULT */ {
  return libAmsi_dll.AmsiNotifyOperation!(util.toPointer(amsiContext), util.toPointer(buffer), length, util.pwstrToFfi(contentName), util.toPointer(result));
}

export function AmsiScanString(
  amsiContext: Uint8Array | Deno.PointerValue /* Windows.Win32.System.Antimalware.HAMSICONTEXT */,
  string: string | null | Uint8Array | Uint16Array /* Windows.Win32.Foundation.PWSTR */,
  contentName: string | null | Uint8Array | Uint16Array /* Windows.Win32.Foundation.PWSTR */,
  amsiSession: Uint8Array | Deno.PointerValue /* Windows.Win32.System.Antimalware.HAMSISESSION */,
  result: Deno.PointerValue | Uint8Array /* ptr */,
): Deno.PointerValue /* Windows.Win32.Foundation.HRESULT */ {
  return libAmsi_dll.AmsiScanString!(util.toPointer(amsiContext), util.pwstrToFfi(string), util.pwstrToFfi(contentName), util.toPointer(amsiSession), util.toPointer(result));
}

export function InstallELAMCertificateInfo(
  ELAMFile: Uint8Array | Deno.PointerValue /* Windows.Win32.Foundation.HANDLE */,
): boolean /* Windows.Win32.Foundation.BOOL */ {
  return util.boolFromFfi(libKERNEL32_dll.InstallELAMCertificateInfo!(util.toPointer(ELAMFile)));
}

